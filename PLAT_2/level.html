<!DOCTYPE html>
<html>
<head>
<title>Test</title>
</head>

<script src="../js/colorFuns.js"></script>
<script type="text/javascript">


function init() {

	//Initialize Canvas
	c = document.getElementById("blah");
	ctx = c.getContext("2d");

	//Initialize Ground
	ground = [[]];
	
	//Initialize Game vars
	game = new Object();
	game.tileSize = 10;
	
	toggleUpdate = 0;
	game.groundIndex = 0;
}
	
function mousePos(e) {

	var xOffset=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft);
	var yOffset=Math.max(document.documentElement.scrollTop,document.body.scrollTop);

	mouseX = e.clientX + xOffset - c.offsetLeft;
	mouseY = e.clientY + yOffset - c.offsetTop;
	
	if (toggleUpdate == 1) {
		mainLoop();
	}

}
	
function keyDown(e) {

			//var unicode=e.keyCode? e.keyCode : e.charCode
			if (e.keyCode) {var unicode = e.keyCode}
			//if (e.charCode) {var unicode = e.charCode}

			if (unicode == 87) {keys.up = 1;}
			if (unicode == 65) {keys.left = 1;}
			if (unicode == 83) {keys.down = 1;}
			if (unicode == 68) {keys.right = 1;}
			if (unicode == 32) {keys.space = 1;}

}

function keyUp(e) {

			//var unicode=e.keyCode? e.keyCode : e.charCode
			if (e.keyCode) {var unicode = e.keyCode}
			//if (e.charCode) {var unicode = e.charCode}

			if (unicode == 87) {keys.up = 0;}
			if (unicode == 65) {keys.left = 0;}
			if (unicode == 83) {keys.down = 0;}
			if (unicode == 68) {keys.right = 0;}
			if (unicode == 32) {keys.space = 0;}
}

		//		    87 W
		//	65 A	83 S	68 D



function mainLoop() {

	
	ctx.clearRect(0,0,800,1200);
	
	tempBlockX = Math.floor(mouseX/10);
	tempBlockY = 60-Math.ceil(mouseY/10);
	
	ground[get("platform").value][tempBlockX] = tempBlockY;

	for(j=document.getElementsByTagName("option").length-1; j >= 0; j--)
	{
		ctx.beginPath();
		for (i=0;i<ground[j].length;i++) {
			if (ground[j][i]) {
				ctx.rect(i*game.tileSize, 590-ground[j][i]*game.tileSize, game.tileSize, (ground[j][i]+1)*game.tileSize);
			}

		}
		ctx.fillStyle = randomColor();
		ctx.fill();
	}
}

function addOffset(amount) {

	for (i=0;i<ground[get("platform").value].length;i++) {
		ground[get("platform").value][i] += amount;
	}
}

function addPlatform()
{
	val = get("platform").value;
	ground[document.getElementsByTagName("option").length] = [];
	ground[document.getElementsByTagName("option").length] = [];
	get("platform").innerHTML += "<option value='"+document.getElementsByTagName("option").length+"'>Level "+document.getElementsByTagName("option").length+"</option>";
	get("platform").value = val;
}

function get(id)
{
	return document.getElementById(id);
}

function saveShit()
{
	p = "";
	for(j = 0; j < ground.length; j++)
	{
		p += "game.ground["+j+"][game.groundIndex] = new Array("+ground[j][0];
		for(i=1; i < ground[j].length; i++)
		{
			p += ","+ground[j][i];
		}
		p += ");\n";
	}
	get("p").innerHTML = p;
}

//Start initialization when the page loads
window.onload = init;
</script>

<style type="text/css">
#controls {position: absolute;
		   top: 0;
		   right: 0;
		   }

</style>

<body onkeydown="keyDown(event);" onkeyup="keyUp(event);" onmouseup="toggleUpdate = 0;">

<canvas id="blah" width="1200px" height="1200px" style="border:1px solid black;" onmousemove="mousePos(event);" onmousedown="toggleUpdate = 1;mousePos(event);">
</canvas>

<div id="controls">
<input id="offset" type="text" value="offset" onclick="this.value='';" onblur="if(this.value=='') this.value='offset';" />
<input type="button" value="add offset" onclick="addOffset(parseInt(document.getElementById('offset').value));" /><br><br>
<select id="platform">
	<option value="0">Bottom Ground</option>
</select>
<input type="button" id="addPlatform" value="Add Platform" onclick="addPlatform()" />
<br />
<input id="saveButton" type="button" value="save" onclick="saveShit()" />
<textarea id="p">
</textarea>
</div>




</body>
</html>